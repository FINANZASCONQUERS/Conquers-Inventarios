<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Reporte Gráfico Despachos</title>
<style>
@page { size:A4 landscape; margin:15mm 15mm 18mm 15mm; }
body { font-family:'Segoe UI', Arial, sans-serif; font-size:12px; color:#2d3436; background:#f5f7fa; }
h1 { font-size:20px; margin:0; color:#1b4f72; }
.header { text-align:center; margin-bottom:4px; }
.brand { display:flex; flex-direction:column; align-items:center; gap:2px; }
.brand img { height:60px; }
.meta { display:none; }
.badge-total { background:#0b8552; color:#fff; padding:10px 14px; border-radius:8px; font-size:11px; font-weight:600; line-height:1.2; }
.layout { border:1px solid #e0e6ec; background:#fff; border-radius:10px; padding:14px 18px 10px; }
.chart-wrapper { position:relative; }
.chart-wrapper img { width:100%; border:1px solid #e5e9ed; border-radius:6px; }
.sub { font-size:11px; color:#7d8a97; margin-top:4px; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { padding:6px 8px; border-bottom:1px solid #ecf0f1; }
th { text-align:left; font-size:11px; text-transform:uppercase; letter-spacing:.5px; background:#f4f7fb; color:#1b4f72; }
td:last-child, th:last-child { text-align:right; }
.footer { margin-top:6px; font-size:10px; color:#8d99a6; text-align:right; }
.watermark { position:fixed; top:40%; left:20%; font-size:120px; color:#1b4f7215; transform:rotate(-25deg); }
</style>
</head>
<body>
<div class="watermark">CONQUERS</div>
<div class="header">
    <div class="brand">
        {% if logo_base64 %}
            <img src="data:image/jpeg;base64,{{ logo_base64 }}" alt="Logo" />
        {% else %}
            <div style="font-size:22px;font-weight:700;color:#1b4f72;">LOGO</div>
        {% endif %}
        <h1 style="margin-top:2px;">Distribución de Despachos</h1>
        <div class="badge-total" style="margin-top:4px;">{{ total_box_text if total_box_text else ('TOTAL %.2f BBL'|format(total_barriles)) }}</div>
    </div>
</div>

<div class="layout">
    <div class="chart-wrapper">
        {% if grafico_base64 %}
            <img src="data:image/png;base64,{{ grafico_base64 }}" alt="Gráfico" />
        {% else %}
            <p style="text-align:center; margin:40px 0; color:#888;">Sin datos para mostrar.</p>
        {% endif %}
    </div>
        <div class="sub" style="margin-top:6px; font-size:10px;">(Leyenda integrada en el gráfico. Colores: Azul = Diluyente, Naranja = FO4)</div>
    </div>

    <div style="page-break-before:always;"></div>
    <h2 style="font-size:16px; color:#1b4f72; text-align:center; margin:0 0 8px 0;">Detalle de clientes ordenado por barriles despachados</h2>
    <table>
            <thead>
                <tr><th>#</th><th>Cliente</th><th>Diluyente</th><th>FO4</th><th>Total</th></tr>
            </thead>
            <tbody>
                {% for cliente, dil, fo4, tot in datos_tabla %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ cliente }}</td>
                    <td>{{ '%.2f'|format(dil) }}</td>
                    <td>{{ '%.2f'|format(fo4) }}</td>
                    <td>{{ '%.2f'|format(tot) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    <div class="footer">Reporte interno - Página {{ page_number|default('1') }}</div>
</div>
</body>
</html>