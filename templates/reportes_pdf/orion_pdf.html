<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Inventario Orion</title>
<style>
@page { size:A4 portrait; margin:15mm 15mm 18mm 15mm; }
body { font-family:'Segoe UI','Montserrat',Arial,sans-serif; font-size:12px; color:#2d3436; background:#f5f7fa; margin:0; }
.watermark { position:fixed; top:40%; left:15%; font-size:110px; color:#1b4f7215; transform:rotate(-25deg); }
.header { text-align:center; margin-bottom:8px; }
.brand { display:flex; flex-direction:column; align-items:center; gap:4px; }
.brand img { height:70px; }
h1 { font-size:22px; margin:4px 0 0; color:#1b4f72; letter-spacing:.5px; }
.periodo { font-size:11px; color:#546e7a; }
.footer { margin-top:8px; font-size:10px; color:#8d99a6; text-align:right; }
.day-block { background:#ffffff; border:1px solid #cfd9e1; border-radius:10px; padding:10px 12px 10px; margin-top:14px; box-shadow:0 2px 4px rgba(0,0,0,.06); }
.day-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:4px; }
.day-title { font-size:14px; font-weight:600; color:#1b4f72; }
.day-meta { font-size:10px; color:#60717c; }
table { width:100%; border-collapse:collapse; }
th, td { padding:6px 6px; border-bottom:1px solid #ecf0f1; }
th { background:#1b4f72; color:#fff; font-size:10px; text-align:left; letter-spacing:.4px; }
tbody tr:nth-child(even){ background:#fbfdff; }
tbody tr:hover { background:#eef7fa; }
td.numeric { text-align:right; font-variant-numeric:tabular-nums; }
.grupo-tag { display:inline-block; background:#0b8552; color:#fff; padding:2px 6px; border-radius:12px; font-size:9px; font-weight:600; }
table tfoot td { background:#e8f1f7; font-weight:600; border-top:2px solid #1b4f72; font-size:9px; }
</style>
</head>
<body>
<div class="watermark">CONQUERS</div>
<div class="header">
    <div class="brand">
        {% if logo_base64 %}
            <img src="data:image/jpeg;base64,{{ logo_base64 }}" alt="Logo" />
        {% else %}
            <div style="font-size:24px;font-weight:700;color:#1b4f72;">LOGO</div>
        {% endif %}
        <h1>Inventario Orion</h1>
        <div class="periodo">{{ fecha_reporte }}</div>
    </div>
</div>

{% if historial_grouped %}
  {% for grupo in historial_grouped %}
  <div class="day-block">
    <div class="day-header">
      <div class="day-title">Fecha: {{ grupo.dia }}</div>
      <div class="day-meta">Registros: {{ grupo.registros|length }}</div>
    </div>
    <table>
        <thead>
            <tr>
                <th style="width:10%">TK</th>
                <th style="width:18%">Producto</th>
                <th style="width:12%">BLS @60°F</th>
                <th style="width:8%">API</th>
                <th style="width:8%">%BSW</th>
                <th style="width:8%">%S</th>
                <th style="width:12%">Grupo</th>
                <th style="width:22%">Hora</th>
            </tr>
        </thead>
        <tbody>
            {% for h in grupo.registros %}
            <tr>
                <td>{{ h.tk }}</td>
                <td>{{ h.producto }}</td>
                <td class="numeric">{{ '%.0f'|format(h.bls_60) }}</td>
                <td class="numeric">{{ '%.1f'|format(h.api) }}</td>
                <td class="numeric">{{ '%.2f'|format(h.bsw) }}</td>
                <td class="numeric">{{ '%.2f'|format(h.s) }}</td>
                <td><span class="grupo-tag">{{ h.grupo }}</span></td>
                <td>{{ h.fecha[11:] }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="2" style="text-align:right;">Total Día</td>
                <td class="numeric">{{ '%.0f'|format(grupo.registros|sum(attribute='bls_60')) }}</td>
                <td class="numeric">-</td>
                <td class="numeric">-</td>
                <td class="numeric">-</td>
                <td colspan="2"></td>
            </tr>
        </tfoot>
    </table>
  </div>
  {% endfor %}
{% endif %}

<div class="footer">Generado: {{ fecha_generacion }} | Sistema Inventarios Conquers</div>
</body>
</html>