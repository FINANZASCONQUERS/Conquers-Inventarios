{% extends "base.html" %}

{% block title %}Dashboard | Sistema de Gestión{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}?v=1.0" />
{% endblock %}

{% block page_header %}
<div class="page-header-pro mb-5 fade-in-up">
    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
        <div>
            <ul class="breadcrumb-mini mb-2">
                <li>Inicio</li>
                <li>Panel</li>
                <li>Dashboard</li>
            </ul>
            <h1 class="mb-2"><i class="bi bi-speedometer2 me-2 text-primary"></i>Panel de Control</h1>
            <div class="page-header-meta">
                <span class="d-inline-flex align-items-center gap-2"><i class="bi bi-calendar-check"></i><span
                        id="current-date">{{ current_date }}</span></span>
                <span class="vr"></span>
                <span class="d-inline-flex align-items-center gap-2"><i class="bi bi-activity"></i>Estado
                    consolidado</span>
            </div>
        </div>
        <div class="d-flex align-items-center gap-2">
            <button class="btn btn-soft-primary btn-icon" data-loading="false" id="refreshDashboard"
                data-bs-toggle="tooltip" data-bs-title="Actualizar datos">
                <i class="bi bi-arrow-clockwise"></i>
            </button>
            <a href="{{ url_for('home') }}" class="btn btn-outline-primary d-flex align-items-center gap-2"><i
                    class="bi bi-house"></i><span>Inicio</span></a>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="row g-4 justify-content-center">
    <!-- Tarjeta Reporte Planta -->
    <div class="col-12 col-sm-6 col-xl-3 fade-in-up delay-1">
        <div class="dash-card theme-planta h-100 shadow-sm hover-lift">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="dash-icon pulse-on-hover">
                    <i class="bi bi-buildings-fill"></i>
                </div>
                <span class="badge bg-light text-planta border border-2 border-planta">
                    <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i> Activo
                </span>
            </div>
            <h3 class="dash-title text-planta fw-bold mb-2">Reporte Planta</h3>
            <p class="mb-3 small text-muted lh-base flex-grow-1">
                Indicadores operativos y consolidado de entradas / salidas en planta.
            </p>
            <div class="d-flex align-items-center justify-content-between mt-auto pt-3 border-top">
                <div class="small text-muted">
                    <i class="bi bi-clock-history text-planta me-1"></i>
                    <span class="fw-medium">{{ planta_summary.info_completa }}</span>
                </div>
            </div>
            <div class="dash-btn mt-3">
                <a class="btn btn-accent text-white w-100 d-flex align-items-center justify-content-center gap-2"
                    href="{{ url_for('reporte_planta') }}">
                    <span>Acceder al Reporte</span>
                    <i class="bi bi-arrow-right-circle"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Tarjeta Reporte Tránsito -->
    <div class="col-12 col-sm-6 col-xl-3 fade-in-up delay-2">
        <div class="dash-card theme-transito h-100 shadow-sm hover-lift">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="dash-icon pulse-on-hover">
                    <i class="bi bi-truck"></i>
                </div>
                <span class="badge bg-light text-transito border border-2 border-transito">
                    <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i> Activo
                </span>
            </div>
            <h3 class="dash-title text-transito fw-bold mb-2">Reporte Tránsito</h3>
            <p class="mb-3 small text-muted lh-base flex-grow-1">
                Seguimiento de movimientos y tiempos logísticos en tránsito.
            </p>
            <div class="d-flex align-items-center justify-content-between mt-auto pt-3 border-top">
                <div class="small text-muted">
                    <i class="bi bi-clock-history text-transito me-1"></i>
                    <span class="fw-medium">{{ transito_summary.info_completa }}</span>
                </div>
            </div>
            <div class="dash-btn mt-3">
                <a class="btn btn-accent text-white w-100 d-flex align-items-center justify-content-center gap-2"
                    href="{{ url_for('reporte_transito') }}">
                    <span>Acceder al Reporte</span>
                    <i class="bi bi-arrow-right-circle"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Tarjeta Barcaza Orion -->
    <div class="col-12 col-sm-6 col-xl-3 fade-in-up delay-3">
        <div class="dash-card theme-orion h-100 shadow-sm hover-lift">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="dash-icon pulse-on-hover">
                    <i class="bi bi-water"></i>
                </div>
                <span class="badge bg-light text-orion border border-2 border-orion">
                    <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i> Activo
                </span>
            </div>
            <h3 class="dash-title text-orion fw-bold mb-2">Barcaza Orion</h3>
            <p class="mb-3 small text-muted lh-base flex-grow-1">
                Resumen operativo y métricas clave de la barcaza Orion.
            </p>
            <div class="d-flex align-items-center justify-content-between mt-auto pt-3 border-top">
                <div class="small text-muted">
                    <i class="bi bi-clock-history text-orion me-1"></i>
                    <span class="fw-medium">{{ orion_summary.info_completa }}</span>
                </div>
            </div>
            <div class="dash-btn mt-3">
                <a class="btn btn-accent text-white w-100 d-flex align-items-center justify-content-center gap-2"
                    href="{{ url_for('reporte_barcaza') }}">
                    <span>Acceder al Reporte</span>
                    <i class="bi bi-arrow-right-circle"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Tarjeta Barcaza BITA -->
    <div class="col-12 col-sm-6 col-xl-3 fade-in-up delay-4">
        <div class="dash-card theme-bita h-100 shadow-sm hover-lift">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="dash-icon pulse-on-hover">
                    <i class="bi bi-tsunami"></i>
                </div>
                <span class="badge bg-light text-bita border border-2 border-bita">
                    <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i> Activo
                </span>
            </div>
            <h3 class="dash-title text-bita fw-bold mb-2">Barcaza BITA</h3>
            <p class="mb-3 small text-muted lh-base flex-grow-1">
                Resumen operativo y métricas clave de la barcaza BITA.
            </p>
            <div class="d-flex align-items-center justify-content-between mt-auto pt-3 border-top">
                <div class="small text-muted">
                    <i class="bi bi-clock-history text-bita me-1"></i>
                    <span class="fw-medium">{{ bita_summary.info_completa }}</span>
                </div>
            </div>
            <div class="dash-btn mt-3">
                <a class="btn btn-accent text-white w-100 d-flex align-items-center justify-content-center gap-2"
                    href="{{ url_for('reporte_barcaza_bita') }}">
                    <span>Acceder al Reporte</span>
                    <i class="bi bi-arrow-right-circle"></i>
                </a>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<style>
    .hover-lift {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .hover-lift:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15) !important;
    }

    .pulse-on-hover {
        transition: transform 0.3s ease;
    }

    .hover-lift:hover .pulse-on-hover {
        transform: scale(1.1);
        animation: pulse 1.5s infinite;
    }

    @keyframes pulse {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.8;
        }
    }

    .dash-card {
        border-radius: 16px;
        border: 1px solid rgba(0, 0, 0, 0.08);
        display: flex;
        flex-direction: column;
    }

    .dash-icon {
        font-size: 2.5rem;
        width: 70px;
        height: 70px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 14px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    /* Colores específicos para cada tema */
    .theme-planta .dash-icon {
        background: linear-gradient(135deg, #FFE8D1 0%, #FFD4A3 100%);
        color: #FF8C42;
    }

    .theme-transito .dash-icon {
        background: linear-gradient(135deg, #FFF4CC 0%, #FFE699 100%);
        color: #FFB800;
    }

    .theme-orion .dash-icon {
        background: linear-gradient(135deg, #E8D4FF 0%, #D4B3FF 100%);
        color: #9B59B6;
    }

    .theme-bita .dash-icon {
        background: linear-gradient(135deg, #C8F0E9 0%, #9FE2D4 100%);
        color: #10A37F;
    }

    .text-planta {
        color: #FF8C42 !important;
    }

    .text-transito {
        color: #FFB800 !important;
    }

    .text-orion {
        color: #9B59B6 !important;
    }

    .text-bita {
        color: #10A37F !important;
    }

    .border-planta {
        border-color: #FF8C42 !important;
    }

    .border-transito {
        border-color: #FFB800 !important;
    }

    .border-orion {
        border-color: #9B59B6 !important;
    }

    .border-bita {
        border-color: #10A37F !important;
    }

    /* Botones con colores específicos */
    .theme-planta .btn-accent {
        background: linear-gradient(135deg, #FF8C42 0%, #FF6B1A 100%);
        border: none;
    }

    .theme-transito .btn-accent {
        background: linear-gradient(135deg, #FFB800 0%, #FF9F00 100%);
        border: none;
    }

    .theme-orion .btn-accent {
        background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
        border: none;
    }

    .theme-bita .btn-accent {
        background: linear-gradient(135deg, #10A37F 0%, #0D8B6C 100%);
        border: none;
    }

    .btn-accent {
        transition: all 0.3s ease;
        font-weight: 600;
        padding: 0.625rem 1.25rem;
        border-radius: 10px;
    }

    .btn-accent:hover {
        transform: scale(1.02);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    /* Dark Mode Adjustments */
    html.dark-mode .dash-card {
        background-color: #1e293b;
        /* Slate-800 */
        border-color: #334155;
    }

    html.dark-mode .text-muted {
        color: #cbd5e1 !important;
        /* Slate-300 - Much lighter for better contrast */
    }

    html.dark-mode .dash-title {
        color: #f1f5f9;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    html.dark-mode .theme-planta .dash-icon {
        background: rgba(255, 140, 66, 0.15);
        color: #FF8C42;
        box-shadow: 0 0 15px rgba(255, 140, 66, 0.1);
    }

    html.dark-mode .theme-transito .dash-icon {
        background: rgba(255, 184, 0, 0.15);
        color: #FFB800;
        box-shadow: 0 0 15px rgba(255, 184, 0, 0.1);
    }

    html.dark-mode .theme-orion .dash-icon {
        background: rgba(155, 89, 182, 0.15);
        color: #9B59B6;
        box-shadow: 0 0 15px rgba(155, 89, 182, 0.1);
    }

    html.dark-mode .theme-bita .dash-icon {
        background: rgba(16, 163, 127, 0.15);
        color: #10A37F;
        box-shadow: 0 0 15px rgba(16, 163, 127, 0.1);
    }

    html.dark-mode .badge.bg-light {
        background-color: rgba(255, 255, 255, 0.05) !important;
        border-width: 1px !important;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const dateElement = document.getElementById('current-date');
        if (dateElement) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            dateElement.textContent = new Date().toLocaleDateString('es-ES', options);
        }
        const refreshBtn = document.getElementById('refreshDashboard');
        if (refreshBtn) {
            refreshBtn.addEventListener('click', async () => {
                refreshBtn.setAttribute('data-loading', 'true');
                try {
                    // Aquí podrías hacer un fetch a un endpoint para refrescar KPIs
                    await new Promise(r => setTimeout(r, 1200));
                } finally {
                    refreshBtn.setAttribute('data-loading', 'false');
                }
            });
        }
    });
</script>
{% endblock %}